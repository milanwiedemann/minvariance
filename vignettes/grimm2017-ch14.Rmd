---
title: "Replicating results from online tutorials"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{examples}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(minvariance)
library(tidyverse)
library(lavaan)
library(semPlot)
```

# Replicating Grimm et al (2017) Chapter 14

- [Tutorial Link (Julie Wood)](https://quantdev.ssri.psu.edu/tutorials/growth-modeling-chapter-14-modeling-change-latent-variables-measured-continuous-indicators)

## Load data

```{r data}
data_url <- "https://quantdev.ssri.psu.edu/sites/qdev/files/ECLS_Science.csv"

data_raw <- read_csv(file = url(data_url)) %>% 
  select("id", 
         "s_g3", "r_g3", "m_g3", 
         "s_g5", "r_g5", "m_g5", 
         "s_g8", "r_g8", "m_g8")

# Rename so functions work
data <- data_raw
names(data) <- c("id", 
                 "x_t1_i1", "x_t1_i2", "x_t1_i3", 
                 "x_t2_i1", "x_t2_i2", "x_t2_i3", 
                 "x_t3_i1", "x_t3_i2", "x_t3_i3")
```

## Fit statistics

```{r, warning=F}
long_minvariance(data = data, 
                 n_items = 3, n_timepoints = 3, 
                 return = "fit_statistics") %>% 
  knitr::kable(digits = 3)
```

## Model tests

```{r, warning=F}
long_minvariance(data = data, 
                 n_items = 3, n_timepoints = 3, 
                 return = "model_tests") %>% 
  knitr::kable(digits = 3)
```

# Replicating Online Tutorial Results 

- [Tutorial Link (Nilam Ram)](https://quantdev.ssri.psu.edu/tutorials/intro-basics-longitudinal-measurement-invariance)

## Load data

```{r}
filepath <- "https://quantdev.ssri.psu.edu/sites/qdev/files/WISC_MIexample.csv"
data_raw2 <- read_csv(file = url(filepath))

data2 <- data_raw2

names(data2) <- c("id", 
                  "x_t1_i1", "x_t1_i2", "x_t1_i3", "x_t1_i4", 
                  "x_t2_i1", "x_t2_i2", "x_t2_i3", "x_t2_i4")
```

## Remove correlated uniqueness

```{r}
configural <- long_minvariance_syntax(n_items = 4, n_timepoints = 2, 
                                      model = "configural", 
                                      remove = list(unique_covar = T))

fit_configural <- cfa(configural,
                      data = data2)

summary(fit_configural, fit.measures = TRUE)
```

```{r fig.height=5, fig.width=5, dpi=100}
semPaths(fit_configural, 
         what="path",
         whatLabels = "name",
         sizeInt = 4, sizeMan = 5, sizeLat = 6)
```

## Includeing correlated uniqueness

```{r}
configural_unique <- long_minvariance_syntax(n_items = 4, n_timepoints = 2, 
                                             model = "configural")

fit_configural_unique <- cfa(configural_unique,
                             data = data2)

summary(fit_configural_unique, 
        fit.measures = TRUE)
```

```{r fig.height=5, fig.width=5, dpi=100}
semPaths(fit_configural_unique, 
         what="path",
         whatLabels = "name",
         sizeInt = 4, sizeMan = 5, sizeLat = 6)
```

## Fit statistics

```{r}
long_minvariance(data = data2, 
                 n_items = 4, n_timepoints = 2, 
                 remove = list(unique_covar = T), 
                 return = "fit_statistics") %>% 
  knitr::kable(digits = 3)
```

## Model tests

```{r}
long_minvariance(data = data2, 
                 n_items = 4, n_timepoints = 2, 
                 remove = list(unique_covar = T), 
                 return = "model_tests") %>% 
  knitr::kable(digits = 3)
```
